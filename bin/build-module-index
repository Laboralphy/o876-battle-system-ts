#!/bin/bash

module_name="$1"
script_folder=$(dirname "$(realpath "$0")")
project_folder=$(realpath "$script_folder/../")
target_folder="${project_folder}/src/modules/${module_name}"
index_json="${target_folder}/index.json"


printImport() {
    assetName=$(echo $1 | tr '-' '_')
    echo "import $assetName from './$2';"
}

printMapFill() {
    assetName=$(echo $1 | tr '-' '_')
    echo "        '$1': $assetName,"
}

iterateThroughTargetFolder() {
    while IFS= read -r -d '' this_file; do
        relative_path=$(realpath --relative-to="$target_folder" "$this_file")
        assetFileName=$(basename "$relative_path" .json)
        $2 "$assetFileName" "$relative_path"
    done < <(find "$target_folder/$1" -type f -name "*.json" -print0)
}

doProcess() {
    echo "// generated by $(basename $0) $module_name"
    echo ""
    iterateThroughTargetFolder "" printImport
    echo ""
    echo "export default {"
    echo "    blueprints: {"
    iterateThroughTargetFolder blueprints printMapFill
    echo "    },"
    echo "};"
}

doProcess > "${target_folder}/index.ts"
