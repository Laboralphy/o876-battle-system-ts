#!/bin/bash

echo "generating store getters index"

script_folder=$(dirname "$(realpath "$0")")
store_folder=$(realpath "${script_folder}/../src/store")
getter_folder="${store_folder}/getters"
define_getters_ts="${store_folder}/define-getters.ts"

# Iterate each .ts file
for this_file in "$getter_folder"/*.ts; do
    # Ignore index.ts
    if [ "$(basename "$this_file")" != "index.ts" ]; then
        functionName=$(basename "$this_file" .ts)
        echo "import { $functionName } from './$functionName';" >> $define_getters_ts
    fi
done

echo "// File generated by $(basename $0)" > "$define_getters_ts"
echo "" >> "$define_getters_ts"

for this_file in "$getter_folder"/*.ts; do
    # Ignore index.ts
    if [ "$(basename "$this_file")" != "index.ts" ]; then
        functionName=$(basename "$this_file" .ts)
        echo "import { $functionName } from './getters/$functionName';" >> $define_getters_ts
    fi
done
echo "" >> "$define_getters_ts"

echo "export type GetterReturnType = {" >> "$define_getters_ts"
for this_file in "$getter_folder"/*.ts; do
    # Ignore index.ts
    if [ "$(basename "$this_file")" != "index.ts" ]; then
        functionName=$(basename "$this_file" .ts)
        echo "    $functionName: ReturnType<typeof $functionName>;" >> $define_getters_ts
    fi
done
echo "};" >> "$define_getters_ts"
echo "" >> "$define_getters_ts"

echo "export const Getters = {" >> $define_getters_ts

for this_file in "$getter_folder"/*.ts; do
    functionName=$(basename "$this_file" .ts)
    echo "    $functionName," >> $define_getters_ts
done
echo "};" >> $define_getters_ts

echo "generated: $define_getters_ts"
