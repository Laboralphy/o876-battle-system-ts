#!/bin/bash

echo "generating schemas enum index"

script_folder=$(dirname "$(realpath "$0")")
source_folder=$(realpath "${script_folder}/../src/consts")
target_folder=$(realpath "${script_folder}/../src/schemas/enums")


generateFileContent() {
    local sSchemaName="$1"
    local sConstFilename="$2"
    echo "// File generated by $(basename $0)"
    echo ""
    echo "import z from 'zod';"
    echo "import { CONSTS } from '../../consts';"
    echo ""
    echo "export const ${sSchemaName}Schema = z"
    echo "    .enum(["
    jq -r 'to_entries[] | "        CONSTS.\(.key),"' ${source_folder}/${sConstFilename}.json
    echo "    ])"
    echo "    .describe('fields.${sSchemaName,}');"
    echo ""
    echo "export type ${sSchemaName} = z.infer<typeof ${sSchemaName}Schema>;"
}

generateFile() {
    local sSchemaName="$1"
    local sConstFilename="$2"
    generateFileContent "$sSchemaName" "$sConstFilename" > ${target_folder}/${sSchemaName}.ts
}

generateFile Ability abilities
generateFile AmmoType ammo-types
generateFile AttackType attack-types
generateFile ActionType action-types
generateFile Condition conditions
generateFile DamageType damage-types
generateFile Disease diseases
generateFile EffectSubtype effect-subtypes
generateFile EffectType effect-types
generateFile EntityType entity-types
generateFile Environment environments
generateFile EquipItemOutcome equip-item-outcomes
generateFile EquipmentSlot equipment-slots
generateFile FeatType feat-types
generateFile Immunity immunities
generateFile OnAttackHit on-attack-hit
generateFile Proficiency proficiencies
generateFile PropertyType property-types
generateFile Race races
generateFile RollType roll-types
generateFile SkillProficiency skill-proficiencies
generateFile Skill skills
generateFile Specie species
generateFile ThreatType threat-types
generateFile WeaponAttribute weapon-attributes
generateFile WeaponSize weapon-sizes

echo "generated: all schemas enum"
